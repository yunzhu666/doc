import{escapeHtml as M}from"@mdit/helper";const x="@tab",y=(n,d)=>(t,r,u,_)=>{if(d.state!==n)return!1;let a=t.bMarks[r]+t.tShift[r],o=t.eMarks[r];if(t.src.charAt(a)!=="@")return!1;let e;for(e=0;e<x.length;e++)if(x[e]!==t.src[a+e])return!1;const s=t.src.slice(a,a+e),l=t.src.slice(a+e,o);if(_)return!0;let i=r,b=!1;for(;i<u&&(i++,a=t.bMarks[i]+t.tShift[i],o=t.eMarks[i],!(a<o&&t.sCount[i]<t.blkIndent));)if(t.src[a]==="@"&&t.sCount[i]<=t.sCount[r]){let m=!0;for(e=0;e<x.length;e++)if(x[e]!==t.src[a+e]){m=!1;break}if(m){b=!0;break}}const k=t.parentType,c=t.lineMax;t.parentType="tab",t.lineMax=i-(b?1:0);const p=t.push(`${n}_tab_open`,"",1),[,$,v]=/^(.*?)(?:(?<!\\)#([^#]*))?$/.exec(l.replace(/^:active/,""));p.block=!0,p.markup=s,p.info=$.trim().replace(/\\#/g,"#"),p.meta={active:l.includes(":active")},v&&(p.meta.id=v.trim()),p.map=[r,i-(b?1:0)],t.md.block.tokenize(t,r+1,i+(b?0:1));const f=t.push(`${n}_tab_close`,"",-1);return f.block=!0,f.markup="",t.parentType=k,t.lineMax=c,t.line=i+(b?0:1),!0},S=(n,d)=>(t,r,u,_)=>{let a=t.bMarks[r]+t.tShift[r],o=t.eMarks[r];if(t.src[a]!==":")return!1;let e=a+1;for(;e<=o&&t.src[e]===":";)e++;const s=e-a;if(s<3)return!1;const l=t.src.slice(a,e),i=t.src.slice(e,o),[b,k=""]=i.split("#",2);if(b.trim()!==n)return!1;if(_)return!0;let c=r,p=!1;for(;c<u&&(c++,a=t.bMarks[c]+t.tShift[c],o=t.eMarks[c],!(a<o&&t.sCount[c]<t.blkIndent));)if(t.src[a]===":"&&t.sCount[c]-t.blkIndent<4){for(e=a+1;e<=o&&t.src[e]===":";e++);if(e-a>=s&&(e=t.skipSpaces(e),e>=o)){p=!0;break}}const $=t.parentType,v=t.lineMax;t.parentType=`${n}_tabs`,t.lineMax=c-(p?1:0);const f=t.push(`${n}_tabs_open`,"",1);f.markup=l,f.block=!0,f.info=b,f.meta={id:k.trim()},f.map=[r,c-(p?1:0)];const m=d.state;d.state=n,t.md.block.tokenize(t,r+1,c-(p?1:0)),d.state=m;const h=t.push(`${n}_tabs_close`,"",-1);return h.markup=t.src.slice(a,e),h.block=!0,t.parentType=$,t.lineMax=v,t.line=c+(p?1:0),!0},C=n=>(d,t)=>{const r=[];let u=-1,_=!1,a=-1;for(let o=t;o<d.length;o++){const{block:e,meta:s,type:l,info:i}=d[o];if(e){if(l===`${n}_tabs_open`){a++;continue}if(l===`${n}_tabs_close`){if(a===0)break;a--;continue}if(a>0)continue;if(l===`${n}_tab_open`){_=!0,s.index=r.length,s.active&&(u===-1?u=r.length:s.active=!1),r.push({title:i,index:s.index,...s.id?{id:s.id}:{}});continue}if(l===`${n}_tab_close`)continue;_||(d[o].type=`${n}_tabs_empty`,d[o].hidden=!0)}}return{active:u,data:r.map((o,e)=>({...o,active:e===u}))}},A=(n,d)=>{const{info:t,meta:r}=n[d];return{title:t,index:r.index,...r.id?{id:r.id}:{},isActive:!!r.active}},g={state:null},T=(n,d)=>{const{name:t="tabs",tabsOpenRenderer:r=(e,s,l,i,b,k)=>{const{active:c,data:p}=e,$=s[l];$.attrJoin("class",`${t}-tabs-wrapper`),$.meta.id&&$.attrJoin("data-id",$.meta.id);const v=p.map(({title:f,id:m},h)=>`<button type="button" class="${t}-tab-button${c===h?" active":""}" data-tab="${h}"${m?` data-id="${M(m)}"`:""}${c===h?" data-active":""}>${M(f)}</button>`);return`<div${k.renderAttrs($)}>
  <div class="${t}-tabs-header">
    ${v.join(`
    `)}
  </div>
  <div class="${t}-tabs-container">
`},tabsCloseRenderer:u=()=>`
  </div>
</div>`,tabOpenRenderer:_=(e,s,l,i,b,k)=>{const c=s[l];return c.attrJoin("class",`${t}-tab-content${e.isActive?" active":""}`),c.attrSet("data-index",e.index.toString()),e.id&&c.attrSet("data-id",e.id.toString()),e.isActive&&c.attrJoin("data-active",""),`<div${k.renderAttrs(s[l])}>`},tabCloseRenderer:a=()=>"</div>"}=d??{},o=C(t);n.block.ruler.before("fence",`${t}_tabs`,S(t,g),{alt:["paragraph","reference","blockquote","list"]}),n.block.ruler.before("paragraph",`${t}_tab`,y(t,g),{alt:["paragraph","reference","blockquote","list"]}),n.renderer.rules[`${t}_tabs_open`]=(e,s,l,i,b)=>{const k=o(e,s);return r(k,e,s,l,i,b)},n.renderer.rules[`${t}_tabs_close`]=u,n.renderer.rules[`${t}_tab_open`]=(e,s,...l)=>{const i=A(e,s);return _(i,e,s,...l)},n.renderer.rules[`${t}_tab_close`]=a};export{T as tab};
//# sourceMappingURL=index.js.map
